---
title: 小米路由器3G安装openwrt的折腾记录
date: 2021-04-21 00:00:00
tag: 
  - 开发
  - 杂项
sidebar: auto
category: 
  - 随笔
  - 开发
permalink: /pages/05c9b1/
---

## 前言

这篇博文其实记录的大概是将近两个月之前的事情了，但是这两个月也在断断续续折腾，现在应该折腾的差不多了，所以现在才写。

宿舍以前用的是一个TP-Link的WR886n Rev 2的路由器（非常老了），甚至连IPv6都不支持，导致因为要刷pt，宿舍原来的网络拓扑是入户网线接交换机，再接到我的台式机上，台式机拨号做第一轮NAT，第二块网卡再接到路由器上。因为我台式机装的Arch Linux，内核更新的比较勤，每次更完内核都得重启（不然会出玄学错误），所以网络可用性也没啥保证。

于是这个学期，我打算换个路由器。开学的时候从网管协会某学长那里收了一个小米路由器4A千兆版，原来刷的Pandavan，为了刷openwrt拆了机焊了串口线，结果不知道什么原因，用SPI夹子读闪存的时候可能把它烧了吧，于是第二天从闲鱼上买了个R3G，初始版本带USB的，大概第四天到的。

## 开始折腾

R3Gv1刷openwrt的步骤挺简单的：先刷上官方开发版系统，然后打开ssh，把openwrt的initramfs和kernel镜像刷进去就行了。然后就是标准套路：改opkg的镜像源，安些必要的软件，然后联网。具体可以参考openwrt官方Wiki，我就是照着那上面一步一步刷好的。

本来想做双线均衡的，也都配好了，最后想想没啥必要，就没开。

IPv6就是另一个故事了。学校作为CERNET的节点，宿舍拨号的v4都是公网的IP（但是有防火墙，出去还是走运营商的NAT，入站TCP屏蔽，校内随便访问），但是v6居然是/128的单IP。。。于是配了一下午的NAT6，整的头挺大的。后来不知道为啥NAT6又经常抽风。。。也懒得管了。

后来发现了一个问题：纯v6的站好像没见到过，我需要v6也就是刷刷pt，于是买了个4T的监控盘，插在3.5寸的硬盘盒里插到路由器上，路由器上安个transmission，再配个SAMBA，就可以24*7的刷pt了，而且要看啥片子从挂载的网络驱动器上直接看就行。

但是，最近要去南京录节目，transmission web UI好办，学校有VPN能连回来，但是samba就不行了。。。于是今天配了个webdav，加上VPN，应该能在外面连回来吧（

## 总结

宿舍里的路由器其实能做很多事情，比如刷pt，做NAS等。其实除了用硬路由以外，也能用软路由，有一同学的宿舍就用了个J4105的板子做软路由，上面还跑了一些别的业务（比如Windows虚拟机），前几天因为裸板直接挂墙上有安全隐患被宿管勒令整改了👀。但是综合成本性能等方面考虑，用R3G硬路由还挺香的。毕竟MT7621的性能算是17年旗舰了，有硬路由加速，50M带宽跑满的基础上基本不占CPU。想折腾网络的同学可以先从宿舍网络做起，进而了解整个网络栈。就是这样了。
